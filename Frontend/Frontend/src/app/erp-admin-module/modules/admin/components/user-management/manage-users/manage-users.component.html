<section class="content">
  <div class="content-block">
    <div class="block-header">
      <!-- breadcrumb -->
      <app-breadcrumb [title]="'Manage  Users'" [items]="[' Users']" [active_item]="'Manage  Users'">
      </app-breadcrumb>
    </div>

    <div class="row clearfix row m-t-25">
      <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12">
        <div class="card">
          <div class="body" *ngIf="showForm">
            <div class="row" *ngIf="pageFunction !== 'Add' && formData">
              <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="card bg-color">
                  <div class="chat">
                    <div class="chat-header clearfix">
                      <div class="row">
                        <div class="col-lg-3 col-md-4 col-sm-12 col-xs-12">
                          <div class="chat-about">
                            <div class="chat-with">Posted By</div>
                            <div class="chat-num-messages mt-2">
                              <div class="badge badge-solid-blue" style="color: #fff; background-color: #007bff">
                                {{ formData.postedBy }}
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="col-lg-3 col-md-4 col-sm-12 col-xs-12">
                          <div class="chat-about">
                            <div class="chat-with">Posted Date</div>
                            <div class="chat-num-messages mt-2">
                              <div class="badge badge-solid-pink" style="color: #fff; background-color: #e81c62">
                                {{ formData.postedTime | date : "medium" }}
                              </div>
                            </div>
                          </div>
                        </div>

                        <div class="col-lg-3 col-md-4 col-sm-12 col-xs-12">
                          <div class="chat-about">
                            <div class="chat-with">Verified By</div>
                            <div class="chat-num-messages mt-2">
                              <div class="badge badge-solid-blue" style="color: #fff; background-color: #28a745">
                                {{ formData.verifiedBy }}
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="col-lg-3 col-md-4 col-sm-12 col-xs-12">
                          <div class="chat-about">
                            <div class="chat-with">Verification Date</div>
                            <div class="chat-num-messages mt-2">
                              <div class="badge badge-solid-pink" style="color: #fff; background-color: #d35400">
                                {{ formData.verifiedTime | date : "medium" }}
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-12">
                          <div class="chat-about mt-2 remarks-container">
                            <div class="chat-with">Verifier Remarks</div>
                            <div class="chat-num-messages mt-2">
                              <div class="badge badge-solid-green" style="color: #fff; background-color: #004840">
                                {{ formData.verifierRemarks }}
                              </div>
                            </div>
                          </div>
                          <!-- <div class="chat-about mt-2 remarks-container">
                                <div class="chat-with remarks">
                                  <strong>Approvers Remarks:</strong>
                                  <span class="remarks-content mx-2">{{ formData.hodRemarks }}</span>
                                </div>
                              </div> -->
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="mx-2" col>
              <mat-tab-group animationDuration="1000ms" #tabGroup>
                <mat-tab label="{{pageFunction | uppercase}} USER">
                  <div class="row clearfix mx-2">
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12">
                      <div class="header">
                        <div class="row">
                          <h2>{{ pageFunction }} User</h2>
                        </div>
                      </div>

                      <div>
                        <form class="m-4" [formGroup]="userForm">
                          <div class="row">
                            <div class="col-xl-3 col-lg-3 col-md-12 col-sm-12 mb-1">
                              <mat-form-field class="example-full-width mb-1" appearance="outline">
                                <mat-label>Username</mat-label>
                                <input matInput formControlName="username" />
                                <mat-error *ngIf="
                                    userForm
                                      .get('username')
                                      .hasError('required')
                                  ">Username is required</mat-error>
                              </mat-form-field>
                            </div>
                            <div class="col-xl-3 col-lg-3 col-md-12 col-sm-12 mb-1">
                              <mat-form-field class="example-full-width mb-1" appearance="outline">
                                <mat-label>First Name</mat-label>
                                <input matInput formControlName="firstName" />
                                <mat-error *ngIf="
                                    userForm
                                      .get('firstName')
                                      .hasError('required')
                                  ">First Name is required</mat-error>
                              </mat-form-field>
                            </div>
                            <div class="col-xl-3 col-lg-3 col-md-12 col-sm-12 mb-1">
                              <mat-form-field class="example-full-width mb-1" appearance="outline">
                                <mat-label>Last Name</mat-label>
                                <input matInput formControlName="lastName" />
                                <mat-error *ngIf="
                                    userForm
                                      .get('lastName')
                                      .hasError('required')
                                  ">Last Name is required</mat-error>
                              </mat-form-field>
                            </div>

                            <div class="col-xl-3 col-lg-3 col-md-12 col-sm-12 mb-1">
                              <mat-form-field class="example-full-width mb-1" appearance="outline">
                                <mat-label>Email</mat-label>
                                <input matInput formControlName="email" />
                                <mat-error *ngIf="
                                    userForm.get('email').hasError('email')
                                  ">Invalid email format</mat-error>
                              </mat-form-field>
                            </div>

                            <div class="col-xl-3 col-lg-3 col-md-12 col-sm-12 mb-1">
                              <mat-form-field class="example-full-width mb-1" appearance="outline">
                                <mat-label>Phone Number</mat-label>
                                <input matInput formControlName="phoneNo" />
                                <mat-error *ngIf="
                                    userForm.get('phoneNo').hasError('pattern')
                                  ">Invalid phone number format</mat-error>
                              </mat-form-field>
                            </div>
                          </div>
                        </form>

                        <br>

                        <br>
                        <form class="mx-4" [formGroup]="roleForm"
                          *ngIf="pageFunction === 'Add' || pageFunction === 'Update'">
                          <div class=" roleDisplay">
                            <div class="col-xl-3 col-lg-3 col-md-12 col-sm-12 mb-1">
                              <mat-form-field class="example-full-width mb-1" appearance="outline">
                                <mat-label>Role</mat-label>
                                <input matInput formControlName="name" />
                                <mat-icon matSuffix (click)="rolesLookup()">search</mat-icon>

                                <mat-error *ngIf="roleForm.get('name').hasError('required')">Role is
                                  required</mat-error>
                              </mat-form-field>
                            </div>


                            <div>
                              <button *ngIf="addButton" (click)="addRole()" [disabled]="!roleForm.valid"
                                mat-raised-button color="primary" type="button">
                                Add Role
                              </button>
                              <button *ngIf="editButton" (click)="updateRoleToTable()" [disabled]="!roleForm.valid"
                                mat-raised-button color="primary" type="button">
                                Update Role
                              </button>
                            </div>
                          </div>
                        </form>

                        <br>

                        <br>

                        <div class="row">
                          <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                            <div class="card">
                              <div>
                                <div class="header">
                                  <h2>User Roles</h2>
                                </div>

                                <table mat-table #table matTableExporter [dataSource]="dataSourceRole" matSort
                                  class="mat-cell" #exporter="matTableExporter">
                                  <ng-container matColumnDef="id">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Id</th>
                                    <td mat-cell *matCellDef="let row">
                                      {{ row.id }}</td>
                                  </ng-container>

                                  <ng-container matColumnDef="role">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Role</th>
                                    <td mat-cell *matCellDef="let row">{{ row.name }}</td>
                                  </ng-container>

                                  <ng-container matColumnDef="actions">
                                    <!-- Conditionally render the actions header based on pageFunction -->
                                    <ng-container
                                      *ngIf="pageFunction === 'Add' || pageFunction === 'Update'; else noHeader">
                                      <th mat-header-cell class="pr-0" *matHeaderCellDef>Actions</th>
                                    </ng-container>

                                    <td mat-cell *matCellDef="let row;" class="pr-0">
                                      <!-- Use ngIf to conditionally render actions based on pageFunction -->
                                      <ng-container *ngIf="pageFunction === 'Add' || pageFunction === 'Update'">
                                        <button mat-icon-button color="accent" (click)="editRoleForm(row)"
                                          class="tbl-action-btn">
                                          <app-feather-icons [icon]="'edit'"
                                            [class]="'tbl-fav-edit'"></app-feather-icons>
                                        </button>
                                        <button mat-icon-button color="accent" (click)="deleteRole(row)"
                                          class="tbl-action-btn">
                                          <app-feather-icons [icon]="'trash-2'"
                                            [class]="'tbl-fav-delete'"></app-feather-icons>
                                        </button>
                                      </ng-container>
                                    </td>

                                    <ng-template #noHeader>
                                      <!-- Placeholder for the header when pageFunction is not 'Add' or 'Update'-->
                                      <th mat-header-cell *matHeaderCellDef></th>
                                    </ng-template>
                                  </ng-container>


                                  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                                  <tr mat-row *matRowDef="let row; columns: displayedColumns" [style.cursor]="'pointer'"
                                    matRipple>
                                  </tr>
                                  <tr class="mat-row" *matNoDataRow>
                                    <td class="mat-cell" colspan="4">
                                      No data matching the filter "{{ input.value }}"
                                    </td>
                                  </tr>
                                </table>
                              </div>
                            </div>
                          </div>

                        </div>
                      </div>

                      <!-- Action Buttons -->
                      <div class="row">
                        <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-3">
                          <div mat-dialog-action [align]="'end'">
                            <button class="btn-space" type="button" mat-raised-button color="warn" mat-button
                              (click)="cancel()">
                              Cancel
                            </button>
                            <button mat-raised-button color="primary" [class.auth-spinner]="posting"
                              [disabled]="!userForm.valid || posting" [hidden]="hideSubmit" (click)="submit()">
                              Submit
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </mat-tab>

                <mat-tab label="Multiple Users" *ngIf="pageFunction === 'Add'" label="UPLOAD MULTIPLE USERS">
                  <div [hidden]="hideSubmit">
                    <div class="row clearfix mx-2">
                      <div class="mt-4">
                        <div class="row clearfix">
                          <h5>Upload Excel File</h5>
                        </div>
                        <div class="row align-items-center">
                          <div class="col-xl-10 col-lg-11 col-md-8 col-sm-6">
                            <app-file-upload (change)="handleFileInput($event.target.files)"></app-file-upload>
                          </div>
                          <div class="col-xl-1 col-lg-1 col-md-4 col-sm-6">
                            <button mat-raised-button color="primary" [hidden]="hideSubmit"
                              (click)="downloadTemplate()">
                              <i class="fa fa-download"></i> Excel Template
                            </button>
                          </div>
                        </div>

                        <div class="mt-4 mx-0">
                          <div style="
                              display: flex;
                              flex-wrap: wrap;
                              margin-right: 10px;
                              margin-bottom: 10px;
                            ">
                            <mat-chip-list aria-label="Fish selection">
                              <mat-chip color="accent" selected *ngFor="
                                  let itemError of itemErrors;
                                  let i = index
                                ">
                                <span>{{ i + 1 }}. </span>
                                {{ itemError.field }}: {{ itemError.message }}
                                <mat-icon>error</mat-icon>
                              </mat-chip>
                            </mat-chip-list>
                          </div>

                          <div class="card">
                            <div class="header">
                              <h2>Users</h2>
                            </div>
                            <div class="tableBody">
                              <div class="table-responsive">
                                <table class="table table-hover">
                                  <thead>
                                    <tr>
                                      <th>Username</th>
                                      <th>First Name</th>
                                      <th>Last Name</th>
                                      <th>Email</th>
                                      <th>Phone Number</th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr *ngFor="let item of items">
                                      <td>{{ item.username }}</td>
                                      <td>{{ item.firstName }}</td>
                                      <td>{{ item.lastName }}</td>
                                      <td>{{ item.email }}</td>
                                      <td>{{ item.phoneNo }}</td>
                                    </tr>
                                  </tbody>
                                </table>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <br />
                  <div class="row mx-4 mt-4">
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-3">
                      <div mat-dialog-action [align]="'end'">
                        <button class="btn-space" type="button" mat-raised-button color="warn" mat-button
                          (click)="cancel()">
                          Cancel
                        </button>
                        <button *ngIf="items.length > 0" mat-raised-button color="primary" [hidden]="hideSubmit"
                          [class.auth-spinner]="posting" [disabled]="posting" (click)="submitBatch()">
                          Submit Batch
                        </button>
                      </div>
                    </div>
                  </div>
                </mat-tab>
              </mat-tab-group>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>